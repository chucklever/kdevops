if TERRAFORM_AWS

menu "Resource Location"
source "terraform/aws/kconfigs/Kconfig.location"
endmenu
menu "Compute"
source "terraform/aws/kconfigs/Kconfig.compute"
endmenu
menu "Identity & Access"
source "terraform/aws/kconfigs/Kconfig.identity"
endmenu

choice
	prompt "AWS AMI owner"
	default TERRAFORM_AWS_AMI_DEBIAN if DISTRO_DEBIAN
	default TERRAFORM_AWS_AMI_AMAZON_X86_64 if TARGET_ARCH_X86_64
	default TERRAFORM_AWS_AMI_AMAZON_ARM64 if TARGET_ARCH_ARM64

config TERRAFORM_AWS_AMI_DEBIAN
	bool "Debian"
	help
	  This option will set AWS AMI owner to Debian.

config TERRAFORM_AWS_AMI_AMAZON_X86_64
	bool "Amazon Linux 2023 x86_64 - ami-0efa651876de2a5ce"
	depends on TARGET_ARCH_X86_64 && TERRAFORM_AWS_US_WEST_2
	help
	  This option will set AWS AMI owner to Amazon EC2 images for x86_64.

config TERRAFORM_AWS_AMI_AMAZON_ARM64
	bool "Amazon Linux 2023 ARM64 - ami-0699f753302dd8b00"
	depends on TARGET_ARCH_ARM64 && TERRAFORM_AWS_US_WEST_2
	help
	  This option will set AWS AMI owner to Amazon EC2 images for arm64.

config TERRAFORM_AWS_FEDORA40_X86_64
	bool "Fedora 40 on x86_64"
	depends on TARGET_ARCH_X86_64
	help
	  This option sets the AWS AMI owner to Fedora 40 for x86_64.

config TERRAFORM_AWS_FEDORA40_ARM64
	bool "Fedora 40 on aarch64"
	depends on TARGET_ARCH_ARM64
	help
	  This option sets the AWS AMI owner to Fedora 40 for ARM 64-bit.

config TERRAFORM_AWS_FEDORA41_X86_64
	bool "Fedora 41 on x86_64"
	depends on TARGET_ARCH_X86_64
	help
	  This option sets the AWS AMI owner to Fedora 41 for x86_64.

config TERRAFORM_AWS_FEDORA41_ARM64
	bool "Fedora 41 on aarch64"
	depends on TARGET_ARCH_ARM64
	help
	  This option sets the AWS AMI owner to Fedora 41 for ARM 64-bit.

config TERRAFORM_AWS_RHEL9_X86_64
	bool "RHEL9 x86_64"
	depends on TARGET_ARCH_X86_64
	help
	  This option will set AWS AMI owner to RHEL9 for x86_64.

config TERRAFORM_AWS_RHEL9_ARM64
	bool "RHEL9 ARM 64"
	depends on TARGET_ARCH_ARM64
	help
	  This option will set AWS AMI owner to RHEL9 for ARM64

config TERRAFORM_AWS_SLE15_SP4_X86_64
	bool "SUSE Linux Enterprise Server 15 SP4 x86_64 - ami-079ba66a5e9f2b70e"
	depends on TARGET_ARCH_X86_64 && TERRAFORM_AWS_US_WEST_2
	help
	  This option will set AWS AMI owner to SLE15-SP4 for x86_64.

config TERRAFORM_AWS_SLE15_SP4_ARM64
	bool "SUSE Linux Enterprise Server 15 SP4 ARM64 - ami-00f902c807805f51a"
	depends on TARGET_ARCH_ARM64 && TERRAFORM_AWS_US_WEST_2
	help
	  This option will set AWS AMI owner to SLE15-SP4 for arm64.

endchoice

if TERRAFORM_AWS_AMI_DEBIAN

choice
	prompt "AWS debian release to use"
	default TERRAFORM_AWS_NS_DEBIAN_12_X86_64 if TARGET_ARCH_X86_64
	default TERRAFORM_AWS_NS_DEBIAN_12_ARM64 if TARGET_ARCH_ARM64

config TERRAFORM_AWS_NS_DEBIAN_12_X86_64
	bool "Debian 12 - Bookworm x86_64"
	depends on TARGET_ARCH_X86_64
	help
	  This option will set aws name search to debian-12-hvm-amd64-*
	  Note, to expand on this get the AMI owner ID and then you can
	  see what is available with something like this:

	  aws ec2 describe-images --owners 136693071363  --query 'Images[*].[Description]'

	  In theory we should be able to just automate Kconfig language then
	  for AWS for a distro using 'make dynconfig' on kdevops.

config TERRAFORM_AWS_NS_DEBIAN_12_ARM64
	bool "Debian 12 - Bookworm ARM64"
	depends on TARGET_ARCH_ARM64
	help
	  This option will set aws name search to debian-12-hvm-arm64-*

config TERRAFORM_AWS_NS_DEBIAN_11_X86_64
	bool "Debian 11 - Bullseye x86_64"
	depends on TARGET_ARCH_X86_64
	help
	  This option will set aws name search to debian-11-hvm-amd64-*

config TERRAFORM_AWS_NS_DEBIAN_11_ARM64
	bool "Debian 11 - Bullseye arm64"
	depends on TARGET_ARCH_ARM64
	help
	  This option will set aws name search to debian-11-hvm-arm64-*

config TERRAFORM_AWS_NS_DEBIAN_STRETCH_X86_64
	bool "debian-stretch-hvm-x86_64-"
	depends on TARGET_ARCH_X86_64
	help
	  This option will set aws name search to debian-stretch-hvm-x86_64-*
	  This is no longer supported by the debian community.

config TERRAFORM_AWS_NS_DEBIAN_STRETCH_ARM64
	bool "debian-stretch-hvm-arm64-"
	depends on TARGET_ARCH_ARM64
	help
	  This option will set aws name search to debian-stretch-hvm-arm64-*
	  This is no longer supported by the debian community.

endchoice

config TERRAFORM_AWS_AMI_DEBIAN_OWNER
	string
	default "136693071363" if TERRAFORM_AWS_NS_DEBIAN_12_X86_64 || TERRAFORM_AWS_NS_DEBIAN_12_ARM64
	default "136693071363" if TERRAFORM_AWS_NS_DEBIAN_11_X86_64 || TERRAFORM_AWS_NS_DEBIAN_11_ARM64
	default "379101102735" if TERRAFORM_AWS_NS_DEBIAN_STRETCH_X86_64 || TERRAFORM_AWS_NS_DEBIAN_STRETCH_ARM64

endif

config TERRAFORM_AWS_AMI_OWNER
	string
	default TERRAFORM_AWS_AMI_DEBIAN_OWNER if TERRAFORM_AWS_AMI_DEBIAN
	default "137112412989" if TERRAFORM_AWS_AMI_AMAZON_X86_64 || TERRAFORM_AWS_AMI_AMAZON_ARM64
	default "309956199498" if TERRAFORM_AWS_RHEL9_X86_64 || TERRAFORM_AWS_RHEL9_ARM64
	default "013907871322" if TERRAFORM_AWS_SLE15_SP4_X86_64 || TERRAFORM_AWS_SLE15_SP4_ARM64
	default "125523088429" if TERRAFORM_AWS_FEDORA40_X86_64 || TERRAFORM_AWS_FEDORA40_ARM64
	default "125523088429" if TERRAFORM_AWS_FEDORA41_X86_64 || TERRAFORM_AWS_FEDORA41_ARM64
	help
	  This option specifies the AWS AMI owner.

config TERRAFORM_AWS_NS
	string
	default "debian-12-amd64-*" if TERRAFORM_AWS_NS_DEBIAN_12_X86_64
	default "debian-12-arm64-*" if TERRAFORM_AWS_NS_DEBIAN_12_ARM64
	default "debian-11-amd64-*" if TERRAFORM_AWS_NS_DEBIAN_11_X86_64
	default "debian-11-arm64-*" if TERRAFORM_AWS_NS_DEBIAN_11_ARM64
	default "debian-stretch-hvm-x86_64-*" if TERRAFORM_AWS_NS_DEBIAN_STRETCH_X86_64
	default "debian-stretch-hvm-arm64-*" if TERRAFORM_AWS_NS_DEBIAN_STRETCH_ARM64
	default "al2023-*-x86_64" if TARGET_ARCH_X86_64 && TERRAFORM_AWS_AMI_AMAZON_X86_64
	default "al2023-*-arm64" if TARGET_ARCH_ARM64 && TERRAFORM_AWS_AMI_AMAZON_ARM64
	default "RHEL-9.*x86_64-*" if TERRAFORM_AWS_RHEL9_X86_64
	default "RHEL-9.*arm64-*" if TERRAFORM_AWS_RHEL9_ARM64
	default "Fedora-Cloud-Base-AmazonEC2.x86_64-40-*" if TERRAFORM_AWS_FEDORA40_X86_64
	default "Fedora-Cloud-Base-AmazonEC2.aarch64-40-*" if TERRAFORM_AWS_FEDORA40_ARM64
	default "Fedora-Cloud-Base-AmazonEC2.x86_64-41-*" if TERRAFORM_AWS_FEDORA41_X86_64
	default "Fedora-Cloud-Base-AmazonEC2.aarch64-41-*" if TERRAFORM_AWS_FEDORA41_ARM64
	default "suse-sles-15-sp4-*x86_64" if TARGET_ARCH_X86_64 && TERRAFORM_AWS_SLE15_SP4_X86_64
	default "suse-sles-15-sp4-*arm64" if TARGET_ARCH_ARM64 && TERRAFORM_AWS_SLE15_SP4_ARM64
	help
	  This option will set aws image search to use. Using this filter glob
	  lets us get the latest ami for this owner / release.

	  For debian updates you can use this list for AMI updates:

	  https://wiki.debian.org/Cloud/AmazonEC2Image/Stretch

	  If you want to expand on this list or just use a value yourself here
	  read:

	  https://letslearndevops.com/2018/08/23/terraform-get-latest-centos-ami/

	  To get filter values you can first setup aws cli:

	  https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration

	  Get your image ami id, for debian 9 amd64 on the us-west1 this is
	  ami-0adbaf2e0ce044437 so you can run:

	  aws ec2 describe-images --image-ids ami-0adbaf2e0ce044437 | grep Name

	  For details:

	  https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-images.html

config TERRAFORM_AWS_ENABLE_EBS_VOLUMES
	bool "Enable EBS volumes"
	help
	  Enable this to enable EBS volumes.

if TERRAFORM_AWS_ENABLE_EBS_VOLUMES

choice
	prompt "Number of EBS volumes"
	default TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_4

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_1
	bool "1"
	help
	  Use 1 EBS volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_2
	bool "2"
	help
	  Use 2 EBS volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_3
	bool "3"
	help
	  Use 3 EBS volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_4
	bool "4"
	help
	  Use 4 volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_5
	bool "5"
	help
	  Use 5 volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_6
	bool "6"
	help
	  Use 6 volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_7
	bool "7"
	help
	  Use 7 volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_8
	bool "8"
	help
	  Use 8 EBS volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_9
	bool "9"
	help
	  Use 9 EBS volumes on instances.

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_10
	bool "10"
	help
	  Use 10 EBS volumes on instances.

endchoice

config TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE
	int
	default 1 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_1
	default 2 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_2
	default 3 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_3
	default 4 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_4
	default 5 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_5
	default 6 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_6
	default 7 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_7
	default 8 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_8
	default 9 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_9
	default 10 if TERRAFORM_AWS_EBS_NUM_VOLUMES_PER_INSTANCE_10

choice
	prompt "Device type for all EBS volumes"
	default TERRAFORM_AWS_EBS_VOLUME_TYPE_GP2
	help
	  This setting specifies the type of device to provision
	  for EBS volumes attached to kdevops instances.

config TERRAFORM_AWS_EBS_VOLUME_TYPE_GP2
	bool "gp2"
	help
	  All extra EBS volumes are "General Purpose SSD volumes",
	  version 2.

config TERRAFORM_AWS_EBS_VOLUME_TYPE_GP3
	bool "gp3"
	help
	  All extra EBS volumes are "General Purpose SSD volumes",
	  version 3.

config TERRAFORM_AWS_EBS_VOLUME_TYPE_IO1
	bool "io1"
	help
	  All extra EBS volumes are "Provisioned IOPS SSD volumes"
	  version 1.

config TERRAFORM_AWS_EBS_VOLUME_TYPE_IO2
	bool "io2"
	help
	  All extra EBS volumes are "Provisioned IOPS SSD volumes"
	  version 2.

endchoice

config TERRAFORM_AWS_EBS_VOLUME_TYPE
	string
	default "gp2" if TERRAFORM_AWS_EBS_VOLUME_TYPE_GP2
	default "gp3" if TERRAFORM_AWS_EBS_VOLUME_TYPE_GP3
	default "io1" if TERRAFORM_AWS_EBS_VOLUME_TYPE_IO1
	default "io2" if TERRAFORM_AWS_EBS_VOLUME_TYPE_IO2

config TERRAFORM_AWS_EBS_VOLUME_NEEDS_IOPS
	bool
	default n if TERRAFORM_AWS_EBS_VOLUME_TYPE_GP2
	default n if TERRAFORM_AWS_EBS_VOLUME_TYPE_GP3
	default y if TERRAFORM_AWS_EBS_VOLUME_TYPE_IO1
	default y if TERRAFORM_AWS_EBS_VOLUME_TYPE_IO2

if TERRAFORM_AWS_EBS_VOLUME_NEEDS_IOPS

config TERRAFORM_AWS_EBS_VOLUME_IOPS
	int "IOPS provisioned for EBS volumes"
	help
	  This setting specifies the IOPS to be provisioned for each
	  extra EBS volume.

endif

choice
	prompt "Volume size for all EBS volumes"
	default TERRAFORM_AWS_EBS_VOLUME_SIZE_32G

config TERRAFORM_AWS_EBS_VOLUME_SIZE_4G
	bool "4G"
	help
	  Use 4 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_8G
	bool "8G"
	help
	  Use 8 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_16G
	bool "16G"
	help
	  Use 16 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_32G
	bool "32G"
	help
	  Use 32 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_64G
	bool "64G"
	help
	  Use 64 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_128G
	bool "128G"
	help
	  Use 128 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_256G
	bool "256G"
	help
	  Use 256 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_512G
	bool "512G"
	help
	  Use 512 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_1024G
	bool "1024G"
	help
	  Use 1024 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_2048G
	bool "2048G"
	help
	  Use 2048 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_3078G
	bool "3078G"
	help
	  Use 3078 GiB EBS volumes.

config TERRAFORM_AWS_EBS_VOLUME_SIZE_4096G
	bool "4096G"
	help
	  Use 4096 GiB EBS volumes.

endchoice

config TERRAFORM_TERRAFORM_AWS_EBS_VOLUME_SIZE
	int
	default 4 if TERRAFORM_AWS_EBS_VOLUME_SIZE_4G
	default 8 if TERRAFORM_AWS_EBS_VOLUME_SIZE_8G
	default 16 if TERRAFORM_AWS_EBS_VOLUME_SIZE_16G
	default 32 if TERRAFORM_AWS_EBS_VOLUME_SIZE_32G
	default 64 if TERRAFORM_AWS_EBS_VOLUME_SIZE_64G
	default 128 if TERRAFORM_AWS_EBS_VOLUME_SIZE_128G
	default 256 if TERRAFORM_AWS_EBS_VOLUME_SIZE_256G
	default 512 if TERRAFORM_AWS_EBS_VOLUME_SIZE_512G
	default 1024 if TERRAFORM_AWS_EBS_VOLUME_SIZE_1024G
	default 2048 if TERRAFORM_AWS_EBS_VOLUME_SIZE_2048G
	default 3078 if TERRAFORM_AWS_EBS_VOLUME_SIZE_3078G
	default 4096 if TERRAFORM_AWS_EBS_VOLUME_SIZE_4096G

endif # TERRAFORM_AWS_ENABLE_EBS_VOLUMES

config TERRAFORM_AWS_DATA_VOLUME_DEVICE_FILE_NAME
	string
	default "/dev/nvme1n1"

endif # TERRAFORM_AWS
